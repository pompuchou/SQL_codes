declare @begin_date date
declare @end_date date
declare @YM nvarchar(10)

set @YM='10805'
set @begin_date=convert(nvarchar(8),convert(int,left(@YM,3))+1911)+right(@YM,2)+'01'
set @end_date=dateadd(dd,-1,dateadd(mm,1,@begin_date))


--201904

--should be in Family Doctor
select	[CASENO]
from	[AL].[dbo].[tbl_opd]
where	SDATE between @begin_date and @end_date
	and [DEPTNAME]='精神科' and [POSINAME] <> '自費' and [ICDCODE1] not in ('2900','29010','29040','2913','2920','29211','29281','29289','2930','29382','2939','29410','29411','2948','2949','29500','29501','29503','29510','29514','29515','29530','29531','29532','29534','29535','29560','29561','29562','29565','29570','29571','29572','29575','29590','29591','29592','29593','29594','29595','29610','29611','29620','29624','29630','29632','29640','29642','29643','29644','29645','29652','29654','29663','2967','29680','29682','29689','29690','29699','2981','2989','29900','29901','29910','29911','29980','29990','29991','30000','30001','30002','3003','3004','3009','30112','30393','30741','34510','3452','3453','4379','30928','3180','319','34510','34590','3182','34551','31401','31239','7998','3439','3181','30723','311','3099','3109','3079','3091','78056','33399','30929','30742','30023','30752','30924','2980','29622','34511','3094','29635','29540','29634','3093','30751','30029','3071','2948','29212','29623','78054', '2970', '3080', '3149', '29189', '29383', '2978', '3090','3142','29626','29621')


--should be in psychiatry

select	A.[CASENO]
from	[AL].[dbo].[tbl_opd] as A
	left outer join
		[AL].[dbo].[tbl_opd_order] as B
		on A.[CASENO]=B.[CASENO]
where	A.SDATE between @begin_date and @end_date
	and A.[DEPTNAME]<>'精神科' and A.[POSINAME] <> '自費' and B.[rid] in ('45046','45087','45102','45010')

select	[CASENO],[RMNO]
from	[AL].[dbo].[tbl_opd]
where	SDATE between @begin_date and @end_date
	and [DEPTNAME]<>'精神科' and [POSINAME] <> '自費' and [ICDCODE1] in ('2900','29010','29040','2913','2920','29211','29281','29289','2930','29382','2939','29410','29411','2948','2949','29500','29501','29503','29510','29514','29515','29530','29531','29532','29534','29535','29560','29561','29562','29565','29570','29571','29572','29575','29590','29591','29592','29593','29594','29595','29610','29611','29620','29624','29630','29632','29640','29642','29643','29644','29645','29652','29654','29663','2967','29680','29682','29689','29690','29699','2981','2989','29900','29901','29910','29911','29980','29990','29991','30000','30001','30002','3003','3004','3009','30112','30393','30741','3452','3453','4379','30928','3180','319','3182','31401','31239','7998','3439','3181','30723','311','3099','3109','3079','3091','78056','33399','30929','30742','30023','30752','30924','2980','29622','3094','29635','29540','29621')


